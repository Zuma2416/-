# シフト自動作成ツール with AI アシスタント

職員の勤務可能日と希望休を基に自動でシフトを作成し、AI との自然言語対話でシフトを修正できるシフト管理システムです。

## 主な機能

### 🤖 AI シフトアシスタント（新機能！）
- **自然言語でシフトを修正**: 「15日の日勤に山田さんを追加して」のような自然な指示でシフトを変更
- **会話形式の対話**: 文脈を理解した継続的な会話が可能
- **制約条件の考慮**: 職員の希望休や連続勤務制限などを自動的に考慮
- **変更履歴の追跡**: 実行されたアクションをリアルタイムで確認

### 📅 高度な自動シフト生成
- **制約充足アルゴリズム**: 以下の制約を考慮した最適なシフト生成
  - ✅ 希望休曜日（月・火・水など）
  - ✅ 特定日の休み希望
  - ✅ 最大連続勤務日数
  - ✅ 週間最大勤務時間
  - ✅ 月間目標勤務日数
  - ✅ 職員のシフト優先度

### 👥 職員管理
- 8種類の雇用形態に対応（生活支援員、パート、派遣など）
- 各職員の詳細設定（シフト優先度、勤務制限、希望休など）
- 職員ごとの制約条件を細かく設定可能

### 📊 6種類のシフト管理
1. ①朝番（6:00-11:00）
2. ②日勤（9:00-19:00）
3. ③昼番（11:00-16:00）
4. ④夜勤（16:00-翌9:00）
5. ⑤夜番（19:00-22:00）
6. ⑥夜支（22:00-翌6:00）

### 📋 その他の機能
- シフトテンプレート機能
- カレンダービュー
- 一括入力機能
- シフト統計分析

## セットアップ

### 必要要件
- Node.js 18.x 以上
- Claude API キー（[Anthropic Console](https://console.anthropic.com/)で取得）

### インストール

1. リポジトリのクローン
```bash
git clone <repository-url>
cd shift-management
```

2. 依存パッケージのインストール
```bash
npm install
```

3. 環境変数の設定
```bash
# .env ファイルを作成
cp .env.example .env

# .env ファイルを編集して Claude API キーを設定
# ANTHROPIC_API_KEY=your_api_key_here
```

Claude API キーの取得方法：
1. [Anthropic Console](https://console.anthropic.com/)にアクセス
2. アカウントを作成またはログイン
3. API Keys セクションで新しいキーを作成
4. キーをコピーして `.env` ファイルに貼り付け

## 起動方法

### 開発モード

ターミナルを2つ開いて、以下を実行します：

**ターミナル1: フロントエンド（Reactアプリ）**
```bash
npm run dev
```
→ http://localhost:5173 でアクセス可能

**ターミナル2: バックエンド（AIサーバー）**
```bash
npm run server
```
→ http://localhost:3001 でAPIサーバーが起動

### プロダクションビルド

```bash
# フロントエンドのビルド
npm run build

# プレビュー
npm run preview
```

## 使い方

### 1. 職員設定

「職員設定」タブで職員を登録します：
- 職員名と雇用形態を入力
- 各シフトの優先度を設定（1=最優先、6=不可）
- 希望休曜日を選択
- 特定日の休み希望を追加
- 連続勤務制限や週間勤務時間を設定

### 2. 自動シフト生成

「カレンダー」タブで：
1. 対象月を選択
2. 「自動シフト生成」ボタンをクリック
3. 職員の制約条件を考慮したシフトが自動生成されます
4. 制約違反がある場合は警告が表示されます

### 3. AI アシスタントでシフトを修正

「AI アシスタント」タブで自然言語でシフトを修正：

**使用例：**
- 「15日の日勤に山田さんを追加して」
- 「来週の夜勤を佐藤さんから鈴木さんに変更して」
- 「月曜日の朝番を2名体制にして」
- 「田中さんの25日の勤務を削除して」

**ヒント：**
- 日付、シフト名、職員名を明確に指定する
- 複数の変更も一度に指示できます
- AIは会話の文脈を記憶するので、続けて指示を出せます

### 4. 手動編集

「カレンダー」タブで：
- 各シフト枠をクリックして職員を追加/削除
- 一括入力機能で複数日にまとめて割り当て
- テンプレートを保存して再利用

## プロジェクト構造

```
shift-management/
├── src/                      # フロントエンドソースコード
│   ├── App.jsx              # メインアプリケーション
│   ├── Calendar.jsx         # カレンダー表示
│   ├── ShiftManager.jsx     # シフト管理ロジック（改善版）
│   ├── EmployeeSettings.jsx # 職員設定
│   ├── ShiftTemplate.jsx    # テンプレート管理
│   ├── AIChat.jsx          # AI対話インターフェース（新規）
│   └── ...
├── server/                   # バックエンドサーバー（新規）
│   ├── index.js             # Express サーバー
│   └── aiService.js         # Claude API 統合
├── package.json
├── vite.config.jsx
├── .env                     # 環境変数（要作成）
└── README.md
```

## 技術スタック

### フロントエンド
- **React 18.2**: UIフレームワーク
- **Vite 5.0**: ビルドツール
- **react-calendar**: カレンダーコンポーネント
- **LocalStorage**: データ永続化

### バックエンド
- **Node.js**: サーバー環境
- **Express 5.x**: Webフレームワーク
- **@anthropic-ai/sdk**: Claude API クライアント
- **CORS**: クロスオリジンリクエスト対応

## API エンドポイント

### `POST /api/chat`
AI対話でシフトを修正

**リクエスト:**
```json
{
  "message": "15日の日勤に山田さんを追加して",
  "shifts": { ... },
  "employees": [ ... ],
  "employeeSettings": { ... },
  "conversationHistory": [ ... ]
}
```

**レスポンス:**
```json
{
  "success": true,
  "message": "AIの応答メッセージ",
  "shifts": { ... },
  "modified": true,
  "actions": ["実行されたアクション"],
  "conversationHistory": [ ... ]
}
```

### `POST /api/analyze-shifts`
シフトの統計分析

### `GET /api/health`
サーバーヘルスチェック

## トラブルシューティング

### AIサーバーに接続できない

**問題:** フロントエンドから「サーバーオフライン」と表示される

**解決方法:**
1. バックエンドサーバーが起動しているか確認: `npm run server`
2. ポート3001が使用可能か確認
3. `.env` ファイルに `ANTHROPIC_API_KEY` が正しく設定されているか確認

### Claude API エラー

**問題:** 「AI処理中にエラーが発生しました」

**解決方法:**
1. API キーが有効か確認
2. APIクォータが残っているか確認（[Anthropic Console](https://console.anthropic.com/)）
3. ネットワーク接続を確認

### シフトが生成されない

**問題:** 自動シフト生成で「制約条件を満たす職員がいません」

**解決方法:**
1. 職員設定でシフトの優先度を確認（全員が「6=不可」になっていないか）
2. 希望休が多すぎないか確認
3. 連続勤務制限が厳しすぎないか確認

## 今後の改善予定

- [ ] データベース対応（PostgreSQL/MySQL）
- [ ] ユーザー認証機能
- [ ] シフトのエクスポート機能（CSV、PDF）
- [ ] より高度な最適化アルゴリズム
- [ ] モバイル対応の改善
- [ ] シフト変更の通知機能

## ライセンス

MIT

## サポート

問題が発生した場合は、Issuesで報告してください。

---

開発者: Claude + Human Collaboration
バージョン: 2.0.0（AI アシスタント統合版）
最終更新: 2026年1月
